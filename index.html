<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Gallery</title>

        <!-- PhotoSwipe CSS -->
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/5.4.4/photoswipe.min.css"
        />

        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family:
                    -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto",
                    sans-serif;
                line-height: 1.6;
                color: #000;
                background: #fff;
                font-size: 16px;
                letter-spacing: -0.01em;
            }

            .container {
                max-width: 1120px;
                margin: 0 auto;
                padding: 0 20px;
            }

            /* Header */
            .header {
                padding: 60px 0 40px;
                text-align: center;
                border-bottom: 1px solid #e8e8e8;
                margin-bottom: 60px;
            }

            .header h1 {
                font-size: 2.5rem;
                font-weight: 400;
                margin-bottom: 20px;
                letter-spacing: -0.02em;
            }

            .header p {
                font-size: 1.1rem;
                color: #666;
                font-weight: 300;
                max-width: 600px;
                margin: 0 auto 30px;
            }

            .contact-info {
                font-size: 0.95rem;
                color: #888;
            }

            .contact-info a {
                color: #000;
                text-decoration: none;
                border-bottom: 1px solid transparent;
                transition: border-bottom 0.2s ease;
            }

            .contact-info a:hover {
                border-bottom: 1px solid #000;
            }

            /* Gallery Container */
            .gallery {
                margin-bottom: 80px;
                opacity: 0;
                transition: opacity 0.5s ease;
            }

            .gallery.loaded {
                opacity: 1;
            }

            /* Gallery Rows */
            .gallery-row {
                display: flex;
                gap: 7px;
                margin-bottom: 7px;
                height: 400px; /* Initial height, will be updated by JS */
            }

            .gallery-item {
                position: relative;
                overflow: hidden;
                cursor: pointer;
                background: #f8f8f8;
                transition: opacity 0.3s ease;
                /* Width will be set dynamically by JS based on aspect ratio */
            }

            .gallery-item:hover {
                opacity: 0.85;
            }

            .gallery-item img {
                width: 100%;
                height: 100%;
                object-fit: cover;
                display: block;
                transition: transform 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            }

            .gallery-item:hover img {
                transform: scale(1.03);
            }

            /* Image Overlay */
            .image-overlay {
                position: absolute;
                bottom: 0;
                left: 0;
                right: 0;
                background: linear-gradient(transparent, rgba(0, 0, 0, 0.4));
                color: white;
                padding: 30px 20px 20px;
                opacity: 0;
                transition: opacity 0.3s ease;
                font-size: 0.9rem;
                font-weight: 300;
            }

            .gallery-item:hover .image-overlay {
                opacity: 1;
            }

            /* Loading state */
            .gallery-item.loading {
                background: #f0f0f0;
                animation: pulse 1.5s ease-in-out infinite;
            }

            @keyframes pulse {
                0%,
                100% {
                    opacity: 1;
                }
                50% {
                    opacity: 0.7;
                }
            }

            /* Footer */
            .footer {
                text-align: center;
                padding: 60px 0;
                border-top: 1px solid #e8e8e8;
                font-size: 0.9rem;
                color: #888;
            }

            .back-to-top {
                display: inline-block;
                margin-top: 20px;
                color: #000;
                text-decoration: none;
                font-weight: 400;
                transition: transform 0.2s ease;
            }

            .back-to-top:hover {
                transform: translateY(-2px);
            }

            /* Mobile Responsiveness */
            @media (max-width: 768px) {
                .container {
                    padding: 0 15px;
                }

                .header {
                    padding: 40px 0 30px;
                    margin-bottom: 40px;
                }

                .header h1 {
                    font-size: 2rem;
                }

                .header p {
                    font-size: 1rem;
                }

                .gallery-row {
                    flex-direction: column;
                    height: auto;
                }

                .gallery-item {
                    height: 300px;
                    width: 100% !important;
                }

                .footer {
                    padding: 40px 0;
                }
            }

            @media (max-width: 480px) {
                .header h1 {
                    font-size: 1.8rem;
                }

                .contact-info {
                    font-size: 0.9rem;
                }
            }

            /* Custom PhotoSwipe styling */
            .pswp__bg {
                background: #fff !important;
            }

            .pswp__ui {
                color: #000 !important;
            }

            .pswp__top-bar {
                background: rgba(255, 255, 255, 0.9) !important;
                backdrop-filter: blur(10px);
            }
        </style>
    </head>
    <body>
        <div class="container">
            <header class="header">
                <h1>Xiaohan Zhang</h1>
                <p>Learning how to take photos</p>
                <div class="contact-info">
                    <a href="mailto:xiaohan.zhang14gmail.com"
                        >xiaohan.zhang14gmail.com</a
                    >
                    |
                    <a
                        href="https://www.instagram.com/justxiaohan/"
                        target="_blank"
                        >@justxiaohan</a
                    >
                </div>
            </header>

            <div class="gallery" id="gallery">
                <!-- Row 1: 2 images -->
                <div class="gallery-row">
                    <div
                        class="gallery-item loading"
                        data-pswp-width="1920"
                        data-pswp-height="1080"
                    >
                        <img
                            src="./images/IMG_9503.jpeg"
                            alt="Mountain landscape at golden hour"
                        />
                        <div class="image-overlay">Mountain Vista, 2024</div>
                    </div>
                    <div
                        class="gallery-item loading"
                        data-pswp-width="1920"
                        data-pswp-height="1280"
                    >
                        <img
                            src="https://picsum.photos/1920/1280?random=2"
                            alt="Ocean waves meeting the shore"
                        />
                        <div class="image-overlay">
                            Coastal Reflections, 2024
                        </div>
                    </div>
                </div>

                <!-- Row 2: 3 images -->
                <div class="gallery-row">
                    <div
                        class="gallery-item loading"
                        data-pswp-width="1920"
                        data-pswp-height="1200"
                    >
                        <img
                            src="https://picsum.photos/1920/1200?random=3"
                            alt="Forest path through morning mist"
                        />
                        <div class="image-overlay">Morning Path, 2024</div>
                    </div>
                    <div
                        class="gallery-item loading"
                        data-pswp-width="1920"
                        data-pswp-height="1080"
                    >
                        <img
                            src="https://picsum.photos/1920/1080?random=4"
                            alt="Urban architecture and light"
                        />
                        <div class="image-overlay">Urban Studies, 2024</div>
                    </div>
                    <div
                        class="gallery-item loading"
                        data-pswp-width="1920"
                        data-pswp-height="1440"
                    >
                        <img
                            src="https://picsum.photos/1920/1440?random=5"
                            alt="Desert landscape at sunset"
                        />
                        <div class="image-overlay">Desert Light, 2024</div>
                    </div>
                </div>

                <!-- Row 3: 1 large image -->
                <div class="gallery-row">
                    <div
                        class="gallery-item loading"
                        data-pswp-width="1920"
                        data-pswp-height="1080"
                    >
                        <img
                            src="https://picsum.photos/1920/1080?random=6"
                            alt="Abstract architectural detail"
                        />
                        <div class="image-overlay">Form & Function, 2024</div>
                    </div>
                </div>

                <!-- Row 4: 4 images -->
                <div class="gallery-row">
                    <div
                        class="gallery-item loading"
                        data-pswp-width="1920"
                        data-pswp-height="1080"
                    >
                        <img
                            src="https://picsum.photos/1920/1080?random=7"
                            alt="Street photography"
                        />
                        <div class="image-overlay">Street Life, 2024</div>
                    </div>
                    <div
                        class="gallery-item loading"
                        data-pswp-width="1920"
                        data-pswp-height="1280"
                    >
                        <img
                            src="https://picsum.photos/1920/1280?random=8"
                            alt="Portrait study"
                        />
                        <div class="image-overlay">Portrait, 2024</div>
                    </div>
                    <div
                        class="gallery-item loading"
                        data-pswp-width="1920"
                        data-pswp-height="1200"
                    >
                        <img
                            src="https://picsum.photos/1920/1200?random=9"
                            alt="Nature close-up"
                        />
                        <div class="image-overlay">Nature Study, 2024</div>
                    </div>
                    <div
                        class="gallery-item loading"
                        data-pswp-width="1920"
                        data-pswp-height="1080"
                    >
                        <img
                            src="https://picsum.photos/1920/1080?random=10"
                            alt="Architectural detail"
                        />
                        <div class="image-overlay">Architecture, 2024</div>
                    </div>
                </div>
            </div>

            <footer class="footer">
                <p>
                    Shot on Sony a7cii, Sony a6300, iPhone 12 mini, and iPhone
                    15 Pro
                </p>
                <a href="#" class="back-to-top">↑ Back to Top</a>
            </footer>
        </div>

        <!-- PhotoSwipe JavaScript -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/5.4.4/photoswipe.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/5.4.4/photoswipe-lightbox.min.js"></script>

        <script>
            // Configuration
            const TARGET_HEIGHT = 400; // Target height for rows (can be adjusted)
            const GAP = 7; // Gap between images

            // Function to load image and get dimensions
            function loadImage(src) {
                return new Promise((resolve, reject) => {
                    const img = new Image();
                    img.onload = () =>
                        resolve({
                            width: img.naturalWidth,
                            height: img.naturalHeight,
                            aspectRatio: img.naturalWidth / img.naturalHeight,
                        });
                    img.onerror = reject;
                    img.src = src;
                });
            }

            // Function to calculate optimal row height and widths
            function calculateRowLayout(images, containerWidth) {
                const totalAspectRatio = images.reduce(
                    (sum, img) => sum + img.aspectRatio,
                    0,
                );
                const availableWidth =
                    containerWidth - GAP * (images.length - 1);

                // Calculate height that makes the total width exactly fit the container
                const calculatedHeight = availableWidth / totalAspectRatio;

                // Apply reasonable height constraints
                const minHeight = TARGET_HEIGHT * 0.6;
                const maxHeight = TARGET_HEIGHT * 1.8;
                const constrainedHeight = Math.max(
                    minHeight,
                    Math.min(maxHeight, calculatedHeight),
                );

                // Always use the full container width by scaling widths proportionally
                const idealTotalWidth = images.reduce(
                    (sum, img) => sum + img.aspectRatio * constrainedHeight,
                    0,
                );
                const scaleFactor = availableWidth / idealTotalWidth;

                // Calculate final widths that will exactly fill the container
                const widths = images.map(
                    (img) => img.aspectRatio * constrainedHeight * scaleFactor,
                );

                return {
                    height: constrainedHeight,
                    widths: widths,
                };
            }

            // Function to apply layout to a row
            async function layoutRow(row) {
                const items = Array.from(row.querySelectorAll(".gallery-item"));
                const images = [];

                // Load all images in the row and get their dimensions
                for (const item of items) {
                    const img = item.querySelector("img");
                    try {
                        const dimensions = await loadImage(img.src);
                        images.push(dimensions);

                        // Update PhotoSwipe data attributes with actual dimensions
                        item.dataset.pswpWidth = dimensions.width;
                        item.dataset.pswpHeight = dimensions.height;

                        // Remove loading class
                        item.classList.remove("loading");
                    } catch (error) {
                        console.error("Failed to load image:", img.src);
                        // Use fallback aspect ratio
                        images.push({
                            aspectRatio: 1.5,
                            width: 1920,
                            height: 1280,
                        });
                        item.classList.remove("loading");
                    }
                }

                // Calculate layout
                const containerWidth = row.offsetWidth;
                const layout = calculateRowLayout(images, containerWidth);

                // Apply the layout
                row.style.height = `${layout.height}px`;

                items.forEach((item, index) => {
                    item.style.width = `${layout.widths[index]}px`;
                    item.style.flex = "none";
                });
            }

            // Function to layout all rows
            async function layoutGallery() {
                const gallery = document.getElementById("gallery");
                const rows = Array.from(
                    gallery.querySelectorAll(".gallery-row"),
                );

                // Layout each row
                for (const row of rows) {
                    await layoutRow(row);
                }

                // Show the gallery
                gallery.classList.add("loaded");
            }

            // Handle window resize
            let resizeTimer;
            function handleResize() {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(() => {
                    if (window.innerWidth > 768) {
                        // Only re-layout on desktop
                        layoutGallery();
                    }
                }, 250);
            }

            // Initialize when DOM is loaded
            document.addEventListener("DOMContentLoaded", () => {
                layoutGallery();
                window.addEventListener("resize", handleResize);
            });

            // Initialize PhotoSwipe
            const lightbox = new PhotoSwipeLightbox({
                gallery: "#gallery",
                children: ".gallery-item",
                pswpModule: PhotoSwipe,

                bgOpacity: 1,
                showHideAnimationType: "fade",

                closeTitle: "Close",
                zoomTitle: "Zoom",
                arrowPrevTitle: "Previous",
                arrowNextTitle: "Next",

                wheelToZoom: true,
                pinchToClose: false,
                closeOnVerticalDrag: true,
                allowPanToNext: true,
                loop: true,

                showAnimationDuration: 400,
                hideAnimationDuration: 400,

                preload: [1, 2],

                errorMsg: "Image cannot be loaded",
            });

            // Custom image data handling
            lightbox.addFilter("itemData", (itemData, index) => {
                const img =
                    document.querySelectorAll(".gallery-item img")[index];
                return {
                    src: img.src,
                    width: parseInt(itemData.element.dataset.pswpWidth),
                    height: parseInt(itemData.element.dataset.pswpHeight),
                    alt: img.alt,
                };
            });

            // Initialize PhotoSwipe
            lightbox.init();

            // Smooth scroll for back to top
            document
                .querySelector(".back-to-top")
                .addEventListener("click", (e) => {
                    e.preventDefault();
                    window.scrollTo({
                        top: 0,
                        behavior: "smooth",
                    });
                });

            // Keyboard shortcuts
            document.addEventListener("keydown", (e) => {
                if (e.key === "g" && !e.target.matches("input, textarea")) {
                    e.preventDefault();
                    document.querySelector(".gallery").scrollIntoView({
                        behavior: "smooth",
                    });
                }
            });

            console.log('Gallery loaded • Press "g" to jump to gallery');
        </script>
    </body>
</html>
